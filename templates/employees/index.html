{% extends 'base.html' %}

{% block extra_css %}
<style>
    .profile-link {
        color: #007bff;
        text-decoration: none;
        cursor: pointer;
    }
    .profile-link:hover {
        text-decoration: underline;
    }
</style>
{% endblock %}

{% block content %}
    {% include 'includes/page_header.html' with title='Иерархия сотрудников' show_back_button=True %}

    <div class="table-responsive">
        <table class="table table-bordered table-hover">
            <thead class="thead-light">
                <tr>
                    <th>Сотрудник</th>
                    <th>Отдел</th>
                    <th>Руководители</th>
                    <th>Звонки (более 60 сек) за 24 часа</th>
                </tr>
            </thead>
            <tbody>
                {% for employee in employees %}
                    <tr>
                        <td><span class="profile-link" onclick="openProfile({{ employee.id }})">{{ employee.name }}</span></td>
                        <td>{{ employee.department }}</td>
                        <td>{{ employee.managers|join:", "|default:"-" }}</td>
                        <td>{{ employee.calls_count }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <script>
        function openProfile(userId) {
            BX24.openPath('/company/personal/user/' + userId + '/');
        }
    </script>
{% endblock %}

{% block extra_js %}
<script src="//api.bitrix24.com/api/v1/"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        BX24.init(function () {
            const employeeLinks = document.querySelectorAll('.employee-link');

            employeeLinks.forEach(function (link) {
                link.addEventListener('click', function (e) {
                    e.preventDefault();
                    const userId = this.getAttribute('data-user-id');

                    BX24.openPath('/company/personal/user/' + userId + '/', function () {
                        console.log('Открыт профиль пользователя', userId);
                    });
                });
            });
        });
    });
</script>
{% endblock %}